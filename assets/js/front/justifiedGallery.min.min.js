!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&module.exports?module.exports=function(i,e){return void 0===e&&(e="undefined"!=typeof window?require("jquery"):require("jquery")(i)),t(e),e}:t(jQuery)}((function(t){function i(i,e){this.settings=e,this.checkSettings(),this.imgAnalyzerTimeout=null,this.entries=null,this.buildingRow={entriesBuff:[],width:0,height:0,aspectRatio:0},this.lastFetchedEntry=null,this.lastAnalyzedIndex=-1,this.yield={every:2,flushed:0},this.border=0<=e.border?e.border:e.margins,this.maxRowHeight=this.retrieveMaxRowHeight(),this.suffixRanges=this.retrieveSuffixRanges(),this.offY=this.border,this.rows=0,this.spinner={phase:0,timeSlot:150,$el:t('<div class="jg-spinner"><span></span><span></span><span></span></div>'),intervalId:null},this.scrollBarOn=!1,this.checkWidthIntervalId=null,this.galleryWidth=i.width(),this.$gallery=i}i.prototype.getSuffix=function(t,i){for(var e=i<t?t:i,s=0;s<this.suffixRanges.length;s++)if(e<=this.suffixRanges[s])return this.settings.sizeRangeSuffixes[this.suffixRanges[s]];return this.settings.sizeRangeSuffixes[this.suffixRanges[s-1]]},i.prototype.removeSuffix=function(t,i){return t.substring(0,t.length-i.length)},i.prototype.endsWith=function(t,i){return-1!==t.indexOf(i,t.length-i.length)},i.prototype.getUsedSuffix=function(t){for(var i in this.settings.sizeRangeSuffixes)if(this.settings.sizeRangeSuffixes.hasOwnProperty(i)&&0!==this.settings.sizeRangeSuffixes[i].length&&this.endsWith(t,this.settings.sizeRangeSuffixes[i]))return this.settings.sizeRangeSuffixes[i];return""},i.prototype.newSrc=function(t,i,e,s){var n;return this.settings.thumbnailPath?n=this.settings.thumbnailPath(t,i,e,s):(s=null!==(s=t.match(this.settings.extension))?s[0]:"",n=t.replace(this.settings.extension,""),n=this.removeSuffix(n,this.getUsedSuffix(n)),n+=this.getSuffix(i,e)+s),n},i.prototype.showImg=function(t,i){this.settings.cssAnimation?(t.addClass("jg-entry-visible"),i&&i()):(t.stop().fadeTo(this.settings.imagesAnimationDuration,1,i),t.find(this.settings.imgSelector).stop().fadeTo(this.settings.imagesAnimationDuration,1,i))},i.prototype.extractImgSrcFromImage=function(t){var i=t.data("safe-src"),e="data-safe-src";return void 0===i&&(i=t.attr("src"),e="src"),t.data("jg.originalSrc",i),t.data("jg.src",i),t.data("jg.originalSrcLoc",e),i},i.prototype.imgFromEntry=function(t){return 0===(t=t.find(this.settings.imgSelector)).length?null:t},i.prototype.captionFromEntry=function(t){return 0===(t=t.find("> .jg-caption")).length?null:t},i.prototype.displayEntry=function(t,i,e,s,n,r){t.width(s),t.height(r),t.css("top",e),t.css("left",i);var o,a,h=this.imgFromEntry(t);null!==h?(h.css("width",s),h.css("height",n),h.css("margin-left",-s/2),h.css("margin-top",-n/2),(o=h.data("jg.src"))&&(o=this.newSrc(o,s,n,h[0]),h.one("error",(function(){this.resetImgSrc(h)})),a=function(){h.attr("src",o)},"skipped"===t.data("jg.loaded")&&o?this.onImageEvent(o,function(){this.showImg(t,a),t.data("jg.loaded",!0)}.bind(this)):this.showImg(t,a))):this.showImg(t),this.displayEntryCaption(t)},i.prototype.displayEntryCaption=function(i){var e,s=this.imgFromEntry(i);null!==s&&this.settings.captions?(null===(e=this.captionFromEntry(i))&&(s=s.attr("alt"),this.isValidCaption(s)||(s=i.attr("title")),this.isValidCaption(s))&&(e=t('<div class="jg-caption">'+s+"</div>"),i.append(e),i.data("jg.createdCaption",!0)),null!==e&&(this.settings.cssAnimation||e.stop().fadeTo(0,this.settings.captionSettings.nonVisibleOpacity),this.addCaptionEventsHandlers(i))):this.removeCaptionEventsHandlers(i)},i.prototype.isValidCaption=function(t){return void 0!==t&&0<t.length},i.prototype.onEntryMouseEnterForCaption=function(i){i=this.captionFromEntry(t(i.currentTarget)),this.settings.cssAnimation?i.addClass("jg-caption-visible").removeClass("jg-caption-hidden"):i.stop().fadeTo(this.settings.captionSettings.animationDuration,this.settings.captionSettings.visibleOpacity)},i.prototype.onEntryMouseLeaveForCaption=function(i){i=this.captionFromEntry(t(i.currentTarget)),this.settings.cssAnimation?i.removeClass("jg-caption-visible").removeClass("jg-caption-hidden"):i.stop().fadeTo(this.settings.captionSettings.animationDuration,this.settings.captionSettings.nonVisibleOpacity)},i.prototype.addCaptionEventsHandlers=function(i){var e;void 0===i.data("jg.captionMouseEvents")&&(e={mouseenter:t.proxy(this.onEntryMouseEnterForCaption,this),mouseleave:t.proxy(this.onEntryMouseLeaveForCaption,this)},i.on("mouseenter",void 0,void 0,e.mouseenter),i.on("mouseleave",void 0,void 0,e.mouseleave),i.data("jg.captionMouseEvents",e))},i.prototype.removeCaptionEventsHandlers=function(t){var i=t.data("jg.captionMouseEvents");void 0!==i&&(t.off("mouseenter",void 0,i.mouseenter),t.off("mouseleave",void 0,i.mouseleave),t.removeData("jg.captionMouseEvents"))},i.prototype.clearBuildingRow=function(){this.buildingRow.entriesBuff=[],this.buildingRow.aspectRatio=0,this.buildingRow.width=0},i.prototype.prepareBuildingRow=function(t,i){var e,s,n,r,o=!0,a=0,h=this.galleryWidth-2*this.border-(this.buildingRow.entriesBuff.length-1)*this.settings.margins,g=h/this.buildingRow.aspectRatio,l=this.settings.rowHeight,u=this.buildingRow.width/h>this.settings.justifyThreshold;if(i||t&&"hide"===this.settings.lastRow&&!u){for(e=0;e<this.buildingRow.entriesBuff.length;e++)s=this.buildingRow.entriesBuff[e],this.settings.cssAnimation?s.removeClass("jg-entry-visible"):(s.stop().fadeTo(0,.1),s.find("> img, > a > img").fadeTo(0,0));return-1}for(t&&!u&&"justify"!==this.settings.lastRow&&"hide"!==this.settings.lastRow&&(o=!1,0<this.rows)&&(o=(l=(this.offY-this.border-this.settings.margins*this.rows)/this.rows)*this.buildingRow.aspectRatio/h>this.settings.justifyThreshold),e=0;e<this.buildingRow.entriesBuff.length;e++)r=(s=this.buildingRow.entriesBuff[e]).data("jg.width")/s.data("jg.height"),r=o?(n=e===this.buildingRow.entriesBuff.length-1?h:g*r,g):(n=l*r,l),h-=Math.round(n),s.data("jg.jwidth",Math.round(n)),s.data("jg.jheight",Math.ceil(r)),(0===e||r<a)&&(a=r);return s.hasClass("effect-under")&&(a+=jQuery(s).find(".modula-item-content").height()),this.buildingRow.height=a,o},i.prototype.flushRow=function(t,i){var e,s=this.settings,n=this.border,r=this.prepareBuildingRow(t,i);if(i||t&&"hide"===s.lastRow&&-1===r)this.clearBuildingRow();else{if(this.maxRowHeight&&this.maxRowHeight<this.buildingRow.height&&(this.buildingRow.height=this.maxRowHeight),t&&("center"===s.lastRow||"right"===s.lastRow)){for(var o=this.galleryWidth-2*this.border-(this.buildingRow.entriesBuff.length-1)*s.margins,a=0;a<this.buildingRow.entriesBuff.length;a++)o-=(e=this.buildingRow.entriesBuff[a]).data("jg.jwidth");"center"===s.lastRow?n+=Math.round(o/2):"right"===s.lastRow&&(n+=o)}var h=this.buildingRow.entriesBuff.length-1;for(a=0;a<=h;a++)e=this.buildingRow.entriesBuff[this.settings.rtl?h-a:a],this.displayEntry(e,n,this.offY,e.data("jg.jwidth"),e.data("jg.jheight"),this.buildingRow.height),n+=e.data("jg.jwidth")+s.margins;this.galleryHeightToSet=this.offY+this.buildingRow.height+this.border,this.setGalleryTempHeight(this.galleryHeightToSet+this.getSpinnerHeight()),(!t||this.buildingRow.height<=s.rowHeight&&r)&&(this.offY+=this.buildingRow.height+s.margins,this.rows+=1,this.clearBuildingRow(),this.settings.triggerEvent.call(this,"jg.rowflush"))}};var e=0;i.prototype.rememberGalleryHeight=function(){e=this.$gallery.height(),this.$gallery.height(e)},i.prototype.setGalleryTempHeight=function(t){e=Math.max(t,e),this.$gallery.height(e)},i.prototype.setGalleryFinalHeight=function(t){e=t,this.$gallery.height(t)},i.prototype.checkWidth=function(){this.checkWidthIntervalId=setInterval(t.proxy((function(){var t;this.$gallery.is(":visible")&&(t=parseFloat(this.$gallery.width()),Math.abs(t-this.galleryWidth)>this.settings.refreshSensitivity)&&(this.galleryWidth=t,this.rewind(),this.rememberGalleryHeight(),this.startImgAnalyzer(!0))}),this),this.settings.refreshTime)},i.prototype.isSpinnerActive=function(){return null!==this.spinner.intervalId},i.prototype.getSpinnerHeight=function(){return this.spinner.$el.innerHeight()},i.prototype.stopLoadingSpinnerAnimation=function(){clearInterval(this.spinner.intervalId),this.spinner.intervalId=null,this.setGalleryTempHeight(this.$gallery.height()-this.getSpinnerHeight()),this.spinner.$el.detach()},i.prototype.startLoadingSpinnerAnimation=function(){var t=this.spinner,i=t.$el.find("span");clearInterval(t.intervalId),this.$gallery.append(t.$el),this.setGalleryTempHeight(this.offY+this.buildingRow.height+this.getSpinnerHeight()),t.intervalId=setInterval((function(){t.phase<i.length?i.eq(t.phase).fadeTo(t.timeSlot,1):i.eq(t.phase-i.length).fadeTo(t.timeSlot,0),t.phase=(t.phase+1)%(2*i.length)}),t.timeSlot)},i.prototype.rewind=function(){this.lastFetchedEntry=null,this.lastAnalyzedIndex=-1,this.offY=this.border,this.rows=0,this.clearBuildingRow()},i.prototype.getSelectorWithoutSpinner=function(){return this.settings.selector+", div:not(.jg-spinner)"},i.prototype.getAllEntries=function(){var t=this.getSelectorWithoutSpinner();return this.$gallery.children(t).toArray()},i.prototype.updateEntries=function(i){return 0<(i=i&&null!=this.lastFetchedEntry?(i=this.getSelectorWithoutSpinner(),t(this.lastFetchedEntry).nextAll(i).toArray()):(this.entries=[],this.getAllEntries())).length&&(t.isFunction(this.settings.sort)?i=this.sortArray(i):this.settings.randomize&&(i=this.shuffleArray(i)),this.lastFetchedEntry=i[i.length-1],this.settings.filter?i=this.filterArray(i):this.resetFilters(i)),this.entries=this.entries.concat(i),!0},i.prototype.insertToGallery=function(i){var e=this;t.each(i,(function(){t(this).appendTo(e.$gallery)}))},i.prototype.shuffleArray=function(t){for(var i,e,s=t.length-1;0<s;s--)i=Math.floor(Math.random()*(s+1)),e=t[s],t[s]=t[i],t[i]=e;return this.insertToGallery(t),t},i.prototype.sortArray=function(t){return t.sort(this.settings.sort),this.insertToGallery(t),t},i.prototype.resetFilters=function(i){for(var e=0;e<i.length;e++)t(i[e]).removeClass("jg-filtered")},i.prototype.filterArray=function(i){var e=this.settings;if("string"===t.type(e.filter))return i.filter((function(i){return(i=t(i)).is(e.filter)?(i.removeClass("jg-filtered"),!0):(i.addClass("jg-filtered").removeClass("jg-visible"),!1)}));if(t.isFunction(e.filter)){for(var s=i.filter(e.filter),n=0;n<i.length;n++)-1===s.indexOf(i[n])?t(i[n]).addClass("jg-filtered").removeClass("jg-visible"):t(i[n]).removeClass("jg-filtered");return s}},i.prototype.resetImgSrc=function(t){"src"===t.data("jg.originalSrcLoc")?t.attr("src",t.data("jg.originalSrc")):t.attr("src","")},i.prototype.destroy=function(){clearInterval(this.checkWidthIntervalId),this.stopImgAnalyzerStarter(),t.each(this.getAllEntries(),t.proxy((function(i,e){var s=((s=((e=t(e)).css("width",""),e.css("height",""),e.css("top",""),e.css("left",""),e.data("jg.loaded",void 0),e.removeClass("jg-entry jg-filtered jg-entry-visible"),this.imgFromEntry(e)))&&(s.css("width",""),s.css("height",""),s.css("margin-left",""),s.css("margin-top",""),this.resetImgSrc(s),s.data("jg.originalSrc",void 0),s.data("jg.originalSrcLoc",void 0),s.data("jg.src",void 0)),this.removeCaptionEventsHandlers(e),this.captionFromEntry(e));e.data("jg.createdCaption")?(e.data("jg.createdCaption",void 0),null!==s&&s.remove()):null!==s&&s.fadeTo(0,1)}),this)),this.$gallery.css("height",""),this.$gallery.removeClass("justified-gallery"),this.$gallery.data("jg.controller",void 0),this.settings.triggerEvent.call(this,"jg.destroy")},i.prototype.analyzeImages=function(i){for(var e=this.lastAnalyzedIndex+1;e<this.entries.length;e++){var s=t(this.entries[e]);if(!0===s.data("jg.loaded")||"skipped"===s.data("jg.loaded")){var n=this.galleryWidth-2*this.border-(this.buildingRow.entriesBuff.length-1)*this.settings.margins,r=s.data("jg.width")/s.data("jg.height");if(this.buildingRow.entriesBuff.push(s),this.buildingRow.aspectRatio+=r,this.buildingRow.width+=r*this.settings.rowHeight,this.lastAnalyzedIndex=e,n/(this.buildingRow.aspectRatio+r)<this.settings.rowHeight&&(this.flushRow(!1,0<this.settings.maxRowsCount&&this.rows===this.settings.maxRowsCount),++this.yield.flushed>=this.yield.every))return void this.startImgAnalyzer(i)}else if("error"!==s.data("jg.loaded"))return}0<this.buildingRow.entriesBuff.length&&this.flushRow(!0,0<this.settings.maxRowsCount&&this.rows===this.settings.maxRowsCount),this.isSpinnerActive()&&this.stopLoadingSpinnerAnimation(),this.stopImgAnalyzerStarter(),this.setGalleryFinalHeight(this.galleryHeightToSet),this.settings.triggerEvent.call(this,i?"jg.resize":"jg.complete")},i.prototype.stopImgAnalyzerStarter=function(){this.yield.flushed=0,null!==this.imgAnalyzerTimeout&&(clearTimeout(this.imgAnalyzerTimeout),this.imgAnalyzerTimeout=null)},i.prototype.startImgAnalyzer=function(t){var i=this;this.stopImgAnalyzerStarter(),this.imgAnalyzerTimeout=setTimeout((function(){i.analyzeImages(t)}),.001)},i.prototype.onImageEvent=function(i,e,s){var n,r;(e||s)&&(n=new Image,r=t(n),e&&r.one("load",(function(){r.off("load error"),e(n)})),s&&r.one("error",(function(){r.off("load error"),s(n)})),n.src=i)},i.prototype.init=function(){var i=!1,e=!1,s=this;t.each(this.entries,(function(n,r){var o=t(r);r=s.imgFromEntry(o);if(o.addClass("jg-entry"),!0!==o.data("jg.loaded")&&"skipped"!==o.data("jg.loaded"))if(null!==s.settings.rel&&o.attr("rel",s.settings.rel),null!==s.settings.target&&o.attr("target",s.settings.target),null!==r){var a=s.extractImgSrcFromImage(r);if(!1===s.settings.waitThumbnailsLoad||!a){var h=parseFloat(r.attr("width")),g=parseFloat(r.attr("height"));if("svg"===r.prop("tagName")&&(h=parseFloat(r[0].getBBox().width),g=parseFloat(r[0].getBBox().height)),!isNaN(h)&&!isNaN(g))return o.data("jg.width",h),o.data("jg.height",g),o.data("jg.loaded","skipped"),e=!0,s.startImgAnalyzer(!1),!0}o.data("jg.loaded",!1),i=!0,s.isSpinnerActive()||s.startLoadingSpinnerAnimation(),s.onImageEvent(a,(function(t){o.data("jg.width",t.width),o.data("jg.height",t.height),o.data("jg.loaded",!0),s.startImgAnalyzer(!1)}),(function(){o.data("jg.loaded","error"),s.startImgAnalyzer(!1)}))}else o.data("jg.loaded",!0),o.data("jg.width",o.width()|parseFloat(o.css("width"))|1),o.data("jg.height",o.height()|parseFloat(o.css("height"))|1)})),i||e||this.startImgAnalyzer(!1),this.checkWidth()},i.prototype.checkOrConvertNumber=function(i,e){if("string"===t.type(i[e])&&(i[e]=parseFloat(i[e])),"number"!==t.type(i[e]))throw e+" must be a number";if(isNaN(i[e]))throw"invalid number for "+e},i.prototype.checkSizeRangesSuffixes=function(){if("object"!==t.type(this.settings.sizeRangeSuffixes))throw"sizeRangeSuffixes must be defined and must be an object";var i,e=[];for(i in this.settings.sizeRangeSuffixes)this.settings.sizeRangeSuffixes.hasOwnProperty(i)&&e.push(i);for(var s={0:""},n=0;n<e.length;n++)if("string"===t.type(e[n]))try{s[parseInt(e[n].replace(/^[a-z]+/,""),10)]=this.settings.sizeRangeSuffixes[e[n]]}catch(i){throw"sizeRangeSuffixes keys must contains correct numbers ("+i+")"}else s[e[n]]=this.settings.sizeRangeSuffixes[e[n]];this.settings.sizeRangeSuffixes=s},i.prototype.retrieveMaxRowHeight=function(){var i=null,e=this.settings.rowHeight;if("string"===t.type(this.settings.maxRowHeight))i=this.settings.maxRowHeight.match(/^[0-9]+%$/)?e*parseFloat(this.settings.maxRowHeight.match(/^([0-9]+)%$/)[1])/100:parseFloat(this.settings.maxRowHeight);else{if("number"!==t.type(this.settings.maxRowHeight)){if(!1===this.settings.maxRowHeight||null==this.settings.maxRowHeight)return null;throw"maxRowHeight must be a number or a percentage"}i=this.settings.maxRowHeight}if(isNaN(i))throw"invalid number for maxRowHeight";return i<e?e:i},i.prototype.checkSettings=function(){this.checkSizeRangesSuffixes(),this.checkOrConvertNumber(this.settings,"rowHeight"),this.checkOrConvertNumber(this.settings,"margins"),this.checkOrConvertNumber(this.settings,"border"),this.checkOrConvertNumber(this.settings,"maxRowsCount");var i=["justify","nojustify","left","center","right","hide"];if(-1===i.indexOf(this.settings.lastRow))throw"lastRow must be one of: "+i.join(", ");if(this.checkOrConvertNumber(this.settings,"justifyThreshold"),this.settings.justifyThreshold<0||1<this.settings.justifyThreshold)throw"justifyThreshold must be in the interval [0,1]";if("boolean"!==t.type(this.settings.cssAnimation))throw"cssAnimation must be a boolean";if("boolean"!==t.type(this.settings.captions))throw"captions must be a boolean";if(this.checkOrConvertNumber(this.settings.captionSettings,"animationDuration"),this.checkOrConvertNumber(this.settings.captionSettings,"visibleOpacity"),this.settings.captionSettings.visibleOpacity<0||1<this.settings.captionSettings.visibleOpacity)throw"captionSettings.visibleOpacity must be in the interval [0, 1]";if(this.checkOrConvertNumber(this.settings.captionSettings,"nonVisibleOpacity"),this.settings.captionSettings.nonVisibleOpacity<0||1<this.settings.captionSettings.nonVisibleOpacity)throw"captionSettings.nonVisibleOpacity must be in the interval [0, 1]";if(this.checkOrConvertNumber(this.settings,"imagesAnimationDuration"),this.checkOrConvertNumber(this.settings,"refreshTime"),this.checkOrConvertNumber(this.settings,"refreshSensitivity"),"boolean"!==t.type(this.settings.randomize))throw"randomize must be a boolean";if("string"!==t.type(this.settings.selector))throw"selector must be a string";if(!1!==this.settings.sort&&!t.isFunction(this.settings.sort))throw"sort must be false or a comparison function";if(!1!==this.settings.filter&&!t.isFunction(this.settings.filter)&&"string"!==t.type(this.settings.filter))throw"filter must be false, a string or a filter function"},i.prototype.retrieveSuffixRanges=function(){var t,i=[];for(t in this.settings.sizeRangeSuffixes)this.settings.sizeRangeSuffixes.hasOwnProperty(t)&&i.push(parseInt(t,10));return i.sort((function(t,i){return i<t?1:t<i?-1:0})),i},i.prototype.updateSettings=function(i){this.settings=t.extend({},this.settings,i),this.checkSettings(),this.border=0<=this.settings.border?this.settings.border:this.settings.margins,this.maxRowHeight=this.retrieveMaxRowHeight(),this.suffixRanges=this.retrieveSuffixRanges()},i.prototype.defaults={sizeRangeSuffixes:{},thumbnailPath:void 0,rowHeight:120,maxRowHeight:!1,maxRowsCount:0,margins:1,border:-1,lastRow:"nojustify",justifyThreshold:.9,waitThumbnailsLoad:!0,captions:!0,cssAnimation:!0,imagesAnimationDuration:500,captionSettings:{animationDuration:500,visibleOpacity:.7,nonVisibleOpacity:0},rel:null,target:null,extension:/\.[^.\\/]+$/,refreshTime:200,refreshSensitivity:0,randomize:!1,rtl:!1,sort:!1,filter:!1,selector:"a",imgSelector:"> img, > a > img, > svg, > a > svg",triggerEvent:function(t){this.$gallery.trigger(t)}},t.fn.justifiedGallery=function(e){return this.each((function(s,n){var r=((n=t(n)).addClass("justified-gallery"),n.data("jg.controller"));if(void 0===r){if(null!=e&&"object"!==t.type(e)){if("destroy"===e)return;throw"The argument must be an object"}r=new i(n,t.extend({},i.prototype.defaults,e)),n.data("jg.controller",r)}else if("norewind"!==e){if("destroy"===e)return void r.destroy();r.updateSettings(e),r.rewind()}r.updateEntries("norewind"===e)&&r.init()}))}}));